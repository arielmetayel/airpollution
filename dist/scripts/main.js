var ap=ap||{},ap=ap||{};ap.modules=ap.modules||{};var ap=ap||{};ap.modules=ap.modules||{},ap.modules.map=function(){function a(a){var b=a.accuracy/2;L.marker(a.latlng,{iconUrl:"/src/pin-black256.png"}).addTo(f).bindPopup("אתם נמצאים "+b+" מטרים מכאן").openPopup(),L.circle(a.latlng,b).addTo(f)}function b(a){f.setView([31.782,35.21933],10)}function c(a,b,c,f,g){var h=L.marker([c,f]),i=d(a,b);return e(h,b,a,g),h.bindPopup(i),h}function d(a,b){var c=0,d=0,e="";return"industry"==b?(c=2,d=6,e="תעשיה"):"transportation"==b?(c=4,d=8,e="תחבורה"):(c=3,d=7,e="ייצור חשמל"),str='<div class="marker">',str+="<b>עיר:"+a[0]+"</b><br/>",str+="קוד תחנה: "+a[1]+"<br/>",str+="סוג המזהם: "+e+"<br/>",str+="טונות זיהום/שנה: "+a[c]+" טון<br/>",str+="עלויות חיצוניות מזיהום האויר: "+accounting.formatNumber(a[d])+' ש"ח<br/>',str+="</div>",str}function e(a,b,c,d){var e=0,f={};"industry"==b?(e=2,f[32]=d.iconIndustry32,f[64]=d.iconIndustry64,f[128]=d.iconIndustry128):"transportation"==b?(e=4,f[32]=d.iconTransportation32,f[64]=d.iconTransportation64,f[128]=d.iconTransportation128):(e=3,f[32]=d.iconElectricity32,f[64]=d.iconElectricity64,f[128]=d.iconElectricity128),c[e]<100?a.setIcon(f[32]):c[e]<200?a.setIcon(f[64]):a.setIcon(f[128])}var f=L.map("map"),g=new L.LayerGroup,h=new L.LayerGroup,i=new L.LayerGroup;g.StyledLayerControl={removable:!1},h.StyledLayerControl={removable:!1},i.StyledLayerControl={removable:!1};var j=L.icon({iconUrl:"images/industry32.png",iconSize:[32,32],popupAnchor:[0,-5]}),k=L.icon({iconUrl:"images/industry64.png",iconSize:[64,64],popupAnchor:[0,-5]}),l=L.icon({iconUrl:"images/industry128.png",iconSize:[128,128],popupAnchor:[0,-5]}),m=L.icon({iconUrl:"images/electricity32.png",iconSize:[32,32],popupAnchor:[0,-5]}),n=L.icon({iconUrl:"images/electricity64.png",iconSize:[64,64],popupAnchor:[0,-5]}),o=L.icon({iconUrl:"images/electricity128.png",iconSize:[128,128],popupAnchor:[0,-5]}),p=L.icon({iconUrl:"images/transport32.png",iconSize:[32,32],popupAnchor:[0,-5]}),q=L.icon({iconUrl:"images/transport64.png",iconSize:[64,64],popupAnchor:[0,-5]}),r=L.icon({iconUrl:"images/transport128.png",iconSize:[128,128],popupAnchor:[0,-5]}),s={};s.iconIndustry32=j,s.iconIndustry64=k,s.iconIndustry128=l,s.iconElectricity32=m,s.iconElectricity64=n,s.iconElectricity128=o,s.iconTransportation32=p,s.iconTransportation64=q,s.iconTransportation128=r;var t=[{groupName:"תחומוצות חנקן NOx",expanded:!0,layers:{"תעשיה":g,"ייצור חשמל":h,"תחבורה":i}}],u={container_width:"300px",container_maxHeight:"350px",group_maxHeight:"80px",exclusive:!0};return L.tileLayer("https://{s}.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiaXRhaGFnYWkiLCJhIjoiZmxIdGF5MCJ9.L_VBtl5noeLVHw_bIr4Hag",{maxZoom:18,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',id:"itahagai.md8f4gg5",subdomains:["a","b","c","d"],token:"pk.eyJ1IjoiaXRhaGFnYWkiLCJhIjoiZmxIdGF5MCJ9.L_VBtl5noeLVHw_bIr4Hag"}).addTo(f),f.on("locationfound",a),f.on("locationerror",b),f.locate({setView:!0,maxZoom:10}),Papa.parse("data/pollutants.csv",{header:!1,download:!0,complete:function(a){for(var b=a.data.length,d=0;b>d;d++)if(line=a.data[d],void 0===line[10]||void 0===line[11])console.log("COORDS: are undefined!");else{var e=parseFloat(line[10]),j=parseFloat(line[11]);isNaN(e)||isNaN(j)?console.log("Address: NaN"):(industryMarker=c(a.data[d],"industry",j,e,s),transportationMarker=c(a.data[d],"transportation",j,e,s),electricityMarker=c(a.data[d],"electricity",j,e,s),g.addLayer(industryMarker),h.addLayer(electricityMarker),i.addLayer(transportationMarker))}var k=L.Control.styledLayerControl([],t,u);f.addControl(k)}}),{}}();